---
author: おーせ
pubDatetime: 2024-06-10
title: 正規化とインデックス付与の基準
slug: db-definition-tips
featured: false
draft: false
tags:
  - Database
  - 正規化
  - Index
description: テーブルの正規化とインデックス付与の基準について
---

## はじめに
今回はテーブルの正規化であったり、インデックスを付与するカラムについての基準など調べたことと自分なりに調べた結果をまとめます。<br />
案件でDB設計やって勉強になったので振り返りも兼ねて行なっていこうかと！

## 正規化について
データベースの正規化は、データの冗長性を減らし、一貫性を向上させるためのプロセスのことを指す。
第５正規化まであるが、基本的には第３正規化まで抑えておけばよいとよく言われる。

### 第1正規化
第１正規化の目的は各フィールドに単一の値しか含めないようにテーブルを分割するプロセルのことです。
要件としては、以下のとおりです。
- 各テーブルの行が一意であること（候補キーの設定）
- 各列に分割できない単一の値が入っていること

候補キーとはテーブル上で任意のレコードを特定するためのカラムの集合です。
つまり主キーやユニークキーのことを指します。

```plaintext
学生ID | 氏名 | 電話番号
----------------------
1      | 田中  | 123-4567, 234-5678
2      | 佐藤  | 345-6789
```
上記のテーブルでは、電話番号が複数の値を含んでいるため、「単一の値が入っていること」という第1正規化の条件を満たしていないため、以下のように修正する。

```plaintext
学生ID | 氏名 | 電話番号
----------------------
1      | 田中  | 123-4567
1      | 田中  | 234-5678
2      | 佐藤  | 345-6789

```
各フィールドに単一の値が含まれるように修正することで第１正規化の条件を満たす。
ちなみに、1つのセルに対して1つの値が含まれているとき、この値を「スカラ値」と呼ぶらしい。
### 第２正規化
第2正規化の目的は部分関数従属を排除すること。つまり、候補キー全体に対してすべての非キー属性が完全に従属するようにすることです。要件としては以下のとおり。<br />

- 第１正規化の条件を満たしていること。
- 非キー属性が、主キーの一部にのみ依存しないこと

非キー属性とは、候補キーに含まれないものです。
主キーやユニークキーに含まれないカラムのことを指します。

```plaintext
学生ID | コースID | 氏名 | コース名 | 成績
----------------------------------------
1      | 101      | 田中 | 数学     | A
1      | 102      | 田中 | 英語     | B
2      | 101      | 佐藤 | 数学     | B
```

上記の状態だと、`氏名`と`コース名`は部分関数従属しているため、以下のように修正し、テーブルを分割します。
```plaintext
学生テーブル:
学生ID | 氏名
---------------
1      | 田中
2      | 佐藤

コーステーブル:
コースID | コース名
---------------
101     | 数学
102     | 英語

成績テーブル:
学生ID | コースID | 成績
-----------------------
1      | 101      | A
1      | 102      | B
2      | 101      | B

```

上記のように分割することで、部分関数従属を排除することができる。
### 第３正規化
第3正規化とは、推移的関数従属を排除すること。
つまり、非キー属性が他の非キー属性に依存しないようにすることです。

推移的関数従属について簡単に触れておこうと思います。


条件は以下のとおり。
- 第2正規化の条件を満たしていること。
- 非キー属性が他の非キー属性に依存していないこと

以下の例では、
```plaintext
学生ID | コースID | 成績 | 教授名
----------------------------
1      | 101      | A    | 山田
1      | 102      | B    | 鈴木
2      | 101      | B    | 山田
```

上記を踏まえ、以下のように修正する。
```plaintext
学生テーブル:
学生ID | 氏名
---------------
1      | 田中
2      | 佐藤

コーステーブル:
コースID | コース名 | 教授名
---------------------
101     | 数学     | 山田
102     | 英語     | 鈴木

成績テーブル:
学生ID | コースID | 成績
-----------------------
1      | 101      | A
1      | 102      | B
2      | 101      | B

```

## インデックスについて
